<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing</title>
    <link rel="stylesheet" href="/css/foundation.min.css">
    <link rel="stylesheet" href="/css/app.css">
  </head>
  <body>

    <div class="top-bar">
      <div class="top-bar-left">
        <ul class="dropdown menu" data-dropdown-menu>
          <li class="menu-text"><a href="/">LIDCTooling</a></li>
          <li class="has-submenu">
            
          <li><a href="/building/">Building</a></li>
          
          <li><a href="/usage/">Usage</a></li>
          
        </ul>
      </div>
    </div>
    

    <div class="row">
      <div class="large-12 columns">
        

<h1 id="processing:9633d27b7a2b1f04c4bfd4a47cc90697">Processing</h1>

<h2 id="example:9633d27b7a2b1f04c4bfd4a47cc90697">Example</h2>

<h3 id="get-the-lidc-xml-files:9633d27b7a2b1f04c4bfd4a47cc90697">Get the LIDC XML Files</h3>

<pre><code>wget 'https://wiki.cancerimagingarchive.net/download/attachments/3539039/LIDC-XML-only.tar.gz'
mkdir -p LIDC-XML-only
cd LIDC-XML-only
tar fxvz ../LIDC-XML-only.tar.gz
cd ..
</code></pre>

<h3 id="set-some-useful-variables:9633d27b7a2b1f04c4bfd4a47cc90697">Set some useful variables</h3>

<pre><code>XML=LIDC-XML-only/tcia-lidc-xml/157/158.xml
APIKEY=25f0025c-071c-426d-b15a-199421e2e889
APIKEY=864dcc73-ce40-4f19-8a3e-fce71fc2dba2
</code></pre>

<h3 id="extract-a-seriesinstanceuid-from-an-xml-file:9633d27b7a2b1f04c4bfd4a47cc90697">Extract a SeriesInstanceUID from an XML file</h3>

<pre><code>SeriesInstanceUID=$(build/install/LIDCTooling/bin/Extract SeriesInstanceUID $XML)

# 1.3.6.1.4.1.14519.5.2.1.6279.6001.303494235102183795724852353824
echo $SeriesInstanceUID
</code></pre>

<h3 id="download-the-image-data:9633d27b7a2b1f04c4bfd4a47cc90697">Download the image data</h3>

<pre><code>mkdir -p dicom/$SeriesInstanceUID
wget -O /tmp/$SeriesInstanceUID.zip --quiet --header &quot;api_key: $APIKEY&quot; &quot;https://services.cancerimagingarchive.net/services/v3/TCIA/query/getImage?SeriesInstanceUID=$SeriesInstanceUID&quot;

unzip -qq -o /tmp/$SeriesInstanceUID.zip -d dicom/$SeriesInstanceUID
</code></pre>

<h3 id="extract-the-rois-and-generate-json:9633d27b7a2b1f04c4bfd4a47cc90697">Extract the ROIs and generate JSON</h3>

<pre><code>mkdir -p segmented/$SeriesInstanceUID
build/install/LIDCTooling/bin/Extract segment $XML dicom/$SeriesInstanceUID segmented/$SeriesInstanceUID
</code></pre>

<h3 id="reads-json:9633d27b7a2b1f04c4bfd4a47cc90697"><code>reads.json</code></h3>

<p>The final result of the processing is a file named <a href="usage/reads.json">segmented/$SeriesInstanceUID/reads.json</a>.  It contains information about the original DICOM images, each read, nodules and small nodules found by each radiologist and pointers to a label map for each.</p>

<h2 id="procesing-in-bulk:9633d27b7a2b1f04c4bfd4a47cc90697">Procesing in bulk</h2>

<p>The <code>LIDCFetch</code> application can automatically process an entire <code>XML</code> file containing reads.</p>

<p>Example:</p>

<pre><code class="language-bash">make build
bin/LIDCFetch gather bin/LIDCFetch gather LIDC-XML-only/tcia-lidc-xml/157/158.xml
</code></pre>

<p>Example of processing all the data:</p>

<pre><code class="language-bash">make build
find bin/LIDCFetch gather bin/LIDCFetch gather LIDC-XML-only/tcia-lidc-xml/157/158.xml
</code></pre>

<h2 id="tools:9633d27b7a2b1f04c4bfd4a47cc90697">Tools</h2>

<h3 id="download-dicom-datasets:9633d27b7a2b1f04c4bfd4a47cc90697">Download DICOM datasets</h3>

<p>Downloading DICOM from LIDC is relatively easy.  With an API key issued by the LIDC support team, issue <code>curl</code> commands with an extra header of <code>api_key</code>, e.g.</p>

<pre><code>curl --header &quot;api_key: 25f0025c-071c-426d-b15a-199421e2e889&quot; https://services.cancerimagingarchive.net/services/v3/TCIA/query/getCollectionValues
</code></pre>

<h3 id="download-api:9633d27b7a2b1f04c4bfd4a47cc90697">Download API</h3>

<p>Usage:</p>

<pre><code>LIDCFetch &lt;command&gt; [options]

Commands:

  collections -- get collections
  
  patients    -- get list of patient
    --collection &lt;Collection&gt;  -- collection query value
</code></pre>

<h3 id="xml-to-nifti:9633d27b7a2b1f04c4bfd4a47cc90697">XML To NIfTI</h3>

<p>Load an XML file and convert to NIfTI.</p>

      </div>
    </div>

    <script src="/js/jquery.min.js"></script>
    <script src="/js/what-input.min.js"></script>
    <script src="/js/foundation.min.js"></script>
    <script src="/js/app.js"></script>
  </body>
</html>
